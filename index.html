<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Map Clue Utility üåé</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      text-align: center;
      background-color: #f7f9fc;
      margin: 0;
      padding: 0;
    }

    h1 {
      color: #2c3e50;
      margin: 20px 0 10px;
      font-size: 1.8em;
    }

    #instruction {
      margin-bottom: 10px;
      color: #555;
      font-size: 1em;
    }

    #map {
      height: 60vh;
      width: 90%;
      max-width: 900px;
      margin: 15px auto;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .clue-box {
      background: #fff;
      border: 2px solid #0078a8;
      border-radius: 10px;
      padding: 15px;
      margin: 10px auto 25px;
      width: 90%;
      max-width: 900px;
      text-align: left;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .clue-box p {
      font-size: 1.1em;
      color: #333;
    }

    @media (max-width: 600px) {
      #map {
        height: 50vh;
      }
      h1 {
        font-size: 1.4em;
      }
    }
  </style>
</head>
<body>
  <h1>üåé Drop a Pin, Get a Smart Clue!</h1>
  <div id="instruction">
    Tap or click anywhere on the map to drop a pin and reveal a smart clue about
    the place!
  </div>
  <div id="map"></div>

  <div class="clue-box">
    <p>
      <b>Clue Result:</b>
      <span id="clueOutput">Click on the map to begin your adventure!</span>
    </p>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const map = L.map("map").setView([0, 0], 2);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution:
        '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
    }).addTo(map);

    let currentMarker = null;

    function generateClue(lat, lng, placeInfo) {
      const latDir = lat >= 0 ? "North" : "South";
      const lngDir = lng >= 0 ? "East" : "West";
      const latAbs = Math.abs(lat).toFixed(2);
      const lngAbs = Math.abs(lng).toFixed(2);

      let regionHint = "";

      if (lat > 50 && lng < -100) {
        regionHint = "the cold wilderness of <b>North America</b>.";
      } else if (lat > 35 && lng > -10 && lng < 40) {
        regionHint = "the historic lands of <b>Europe</b>.";
      } else if (lat < -10 && lng > 100) {
        regionHint = "the sunny beaches of <b>Australia</b> or Oceania.";
      } else if (lat < -40 && lng < -50) {
        regionHint = "the chilly edges of <b>South America</b>.";
      } else if (Math.abs(lat) < 5 && Math.abs(lng) < 5) {
        regionHint = "the <b>Center of the World</b> near the Equator!";
      } else {
        regionHint = "a fascinating part of our planet.";
      }

      const placeText = placeInfo
        ? `<br><b>Nearest Place:</b> ${placeInfo}`
        : "";

      return `Pin dropped at (${latAbs}¬∞ ${latDir}, ${lngAbs}¬∞ ${lngDir}). You‚Äôre near ${regionHint}${placeText}`;
    }

    async function onMapClick(e) {
      const { lat, lng } = e.latlng;

      // Remove old marker
      if (currentMarker) map.removeLayer(currentMarker);

      // Add new marker
      currentMarker = L.marker([lat, lng]).addTo(map);

      // Fetch reverse geocoded location
      document.getElementById("clueOutput").innerHTML =
        "üîç Finding nearby place...";

      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`
        );
        const data = await response.json();

        let placeInfo = "";
        if (data.address) {
          const { city, town, village, state, country } = data.address;
          placeInfo =
            city || town || village
              ? `${city || town || village}, ${state || ""}, ${country || ""}`
              : `${state || ""}, ${country || ""}`;
        }

        const clue = generateClue(lat, lng, placeInfo);
        document.getElementById("clueOutput").innerHTML = clue;

        currentMarker
          .bindPopup(`<b>Your Clue:</b><br>${clue}`)
          .openPopup();
      } catch (error) {
        document.getElementById("clueOutput").innerHTML =
          "‚ö†Ô∏è Unable to fetch location details. Try again.";
      }
    }

    map.on("click", onMapClick);
  </script>
</body>
</html>
