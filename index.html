<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Locate India üó∫Ô∏è ‚Äî Practice & Test</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  :root{
    --blue:#2196f3; --bg:#f5f5f5; --card:#fff; --muted:#6b7280; --ok:#16a34a; --bad:#b91c1c;
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;color:#111}
  header{background:var(--blue);color:#fff;padding:12px 10px;text-align:center;font-weight:700}
  main{max-width:1100px;margin:10px auto;padding:0 10px}
  .card{background:var(--card);border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);padding:12px;margin-bottom:12px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  label{font-weight:600}
  select{padding:9px;border:1px solid #d1d5db;border-radius:8px}
  button{background:var(--blue);color:#fff;border:0;border-radius:8px;padding:10px 14px;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  #mapWrap{position:relative}
  #map{height:68vh;width:100%;border-radius:12px}
  #scoreBox{position:absolute;top:10px;right:10px;background:#0b1a;color:#fff;padding:8px 12px;border-radius:10px;display:none}
  #scoreBox b{font-size:1.05rem}
  #msg{margin-top:6px;color:var(--bad);font-weight:700;min-height:20px}
  .muted{color:var(--muted)}
  .pill{display:inline-block;background:#eef6ff;border:1px solid #dbeafe;color:#0b3;padding:6px 10px;border-radius:999px;font-weight:700}
  .hof-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #e5e7eb}
  .center{text-align:center}
  @media (max-width:640px){ #map{height:62vh} }
</style>
</head>
<body>
<header>Locate India üó∫Ô∏è ‚Äî Practice & Test</header>
<main>
  <!-- Controls -->
  <section class="card">
    <div class="row">
      <div>
        <label>Language</label><br/>
        <label><input type="radio" name="lang" value="en" checked> English</label>
        &nbsp;&nbsp;
        <label><input type="radio" name="lang" value="ta"> Tamil</label>
      </div>

      <div>
        <label>Mode</label><br/>
        <label><input type="radio" name="mode" value="practice" checked> Practice</label>
        &nbsp;&nbsp;
        <label><input type="radio" name="mode" value="test"> Test</label>
      </div>

      <div>
        <button id="startBtn">Start</button>
      </div>
    </div>
    <div id="msg"></div>
    <div class="muted">Practice: labels shown for all items (capitals + physical features). Test: labels hidden; you score for accurate clicks. Round = 10 items.</div>
  </section>

  <!-- Map -->
  <section class="card" id="mapWrap">
    <div id="map"></div>
    <div id="scoreBox">Score: <b id="score">0</b> / <span id="outOf">10</span><br><span class="muted" id="qProg">Q 0/10</span></div>
  </section>

  <!-- Hall of Fame -->
  <section class="card">
    <h3>üèÜ Hall of Fame (Top 10 ‚Äî Test mode only)</h3>
    <div class="muted">Saved locally per Language (English/Tamil). Finish a Test to record your result.</div>
    <div id="hofList" class="center" style="margin-top:10px">No entries yet.</div>
  </section>
</main>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* =========================
   Map + Tiles
   ========================= */
const map = L.map("map").setView([22.8, 79.8], 4); // center over India
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors",
}).addTo(map);

/* =========================
   Data (All 28 state capitals + major features)
   kind: 'capital' | 'river' | 'range' | 'plateau' | 'plain' | 'desert' | 'delta' | 'coast' | 'sea' | 'region'
   radiusKm: scoring radius in km (looser for large regions/features)
   ========================= */
const itemsIN = [
  // ---- State capitals (28) ----
  { en:"Amaravati (Andhra Pradesh)", ta:"‡ÆÖ‡ÆÆ‡Æ∞‡Ææ‡Æµ‡Æ§‡Æø (‡ÆÜ‡Æ®‡Øç‡Æ§‡Æø‡Æ∞‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æ§‡Øá‡Æö‡ÆÆ‡Øç)", lat:16.5062, lon:80.6480, kind:'capital', radiusKm:60 },
  { en:"Itanagar (Arunachal Pradesh)", ta:"‡Æá‡Æü‡Ææ‡Æ®‡Æï‡Æ∞‡Øç (‡ÆÖ‡Æ∞‡ØÅ‡Æ£‡Ææ‡Æö‡Øç‡Æö‡Æ≤‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æ§‡Øá‡Æö‡ÆÆ‡Øç)", lat:27.0844, lon:93.6053, kind:'capital', radiusKm:60 },
  { en:"Dispur (Assam)", ta:"‡Æü‡Æø‡Æ∏‡Øç‡Æ™‡ØÇ‡Æ∞‡Øç (‡ÆÖ‡Æö‡Ææ‡ÆÆ‡Øç)", lat:26.1433, lon:91.7898, kind:'capital', radiusKm:60 },
  { en:"Patna (Bihar)", ta:"‡Æ™‡Ææ‡Æü‡Øç‡Æ©‡Ææ (‡Æ™‡ØÄ‡Æï‡Ææ‡Æ∞‡Øç)", lat:25.5941, lon:85.1376, kind:'capital', radiusKm:60 },
  { en:"Raipur (Chhattisgarh)", ta:"‡Æ∞‡Ææ‡ÆØ‡Øç‡Æ™‡ØÇ‡Æ∞‡Øç (‡Æö‡Æ§‡Øç‡Æ§‡ØÄ‡Æ∏‡Øç‡Æï‡Æ∞‡Øç)", lat:21.2514, lon:81.6296, kind:'capital', radiusKm:60 },
  { en:"Panaji (Goa)", ta:"‡Æ™‡Æ£‡Ææ‡Æú‡Æø (‡Æï‡Øã‡Æµ‡Ææ)", lat:15.4909, lon:73.8278, kind:'capital', radiusKm:50 },
  { en:"Gandhinagar (Gujarat)", ta:"‡Æï‡Ææ‡Æ®‡Øç‡Æ§‡Æø‡Æ®‡Æï‡Æ∞‡Øç (‡Æï‡ØÅ‡Æú‡Æ∞‡Ææ‡Æ§‡Øç)", lat:23.2156, lon:72.6369, kind:'capital', radiusKm:60 },
  { en:"Chandigarh (Haryana)", ta:"‡Æö‡Æ£‡Øç‡Æü‡Æø‡Æï‡Æ∞‡Øç (‡Æπ‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ©‡Ææ)", lat:30.7333, lon:76.7794, kind:'capital', radiusKm:60 },
  { en:"Shimla (Himachal Pradesh)", ta:"‡Æ∑‡Æø‡ÆÆ‡Øç‡Æ≤‡Ææ (‡Æá‡ÆÆ‡Ææ‡Æö‡Øç‡Æö‡Æ≤‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æ§‡Øá‡Æö‡ÆÆ‡Øç)", lat:31.1048, lon:77.1734, kind:'capital', radiusKm:60 },
  { en:"Ranchi (Jharkhand)", ta:"‡Æ∞‡Ææ‡Æû‡Øç‡Æö‡Æø (‡Æú‡Ææ‡Æ∞‡Øç‡Æï‡Æ£‡Øç‡Æü‡Øç)", lat:23.3441, lon:85.3096, kind:'capital', radiusKm:60 },
  { en:"Bengaluru (Karnataka)", ta:"‡Æ™‡ØÜ‡Æô‡Øç‡Æï‡Æ≥‡ØÇ‡Æ∞‡ØÅ (‡Æï‡Æ∞‡Øç‡Æ®‡Ææ‡Æü‡Æï‡Ææ)", lat:12.9716, lon:77.5946, kind:'capital', radiusKm:60 },
  { en:"Thiruvananthapuram (Kerala)", ta:"‡Æ§‡Æø‡Æ∞‡ØÅ‡Æµ‡Æ©‡Æ®‡Øç‡Æ§‡Æ™‡ØÅ‡Æ∞‡ÆÆ‡Øç (‡Æï‡Øá‡Æ∞‡Æ≥‡Ææ)", lat:8.5241, lon:76.9366, kind:'capital', radiusKm:50 },
  { en:"Bhopal (Madhya Pradesh)", ta:"‡Æ™‡Øã‡Æ™‡Ææ‡Æ≤‡Øç (‡ÆÆ‡Æ§‡Øç‡Æ§‡Æø‡ÆØ‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æ§‡Øá‡Æö‡ÆÆ‡Øç)", lat:23.2599, lon:77.4126, kind:'capital', radiusKm:60 },
  { en:"Mumbai (Maharashtra)", ta:"‡ÆÆ‡ØÅ‡ÆÆ‡Øç‡Æ™‡Øà (‡ÆÆ‡Æï‡Ææ‡Æ∞‡Ææ‡Æ∑‡Øç‡Æü‡Æø‡Æ∞‡Ææ)", lat:19.0760, lon:72.8777, kind:'capital', radiusKm:50 },
  { en:"Imphal (Manipur)", ta:"‡Æá‡ÆÆ‡Øç‡Æ™‡Ææ‡Æ≤‡Øç (‡ÆÆ‡Æ£‡Æø‡Æ™‡Øç‡Æ™‡ØÇ‡Æ∞‡Øç)", lat:24.8170, lon:93.9368, kind:'capital', radiusKm:60 },
  { en:"Shillong (Meghalaya)", ta:"‡Æ∑‡Æø‡Æ≤‡Øç‡Æ≤‡Ææ‡Æô‡Øç (‡ÆÆ‡Øá‡Æï‡Ææ‡Æ≤‡ÆØ‡Ææ)", lat:25.5788, lon:91.8933, kind:'capital', radiusKm:60 },
  { en:"Aizawl (Mizoram)", ta:"‡Æê‡Æö‡Ææ‡Æ≤‡Øç (‡ÆÆ‡Æø‡Æö‡Øã‡Æ∞‡ÆÆ‡Øç)", lat:23.7271, lon:92.7176, kind:'capital', radiusKm:60 },
  { en:"Kohima (Nagaland)", ta:"‡Æï‡Øä‡Æπ‡Æø‡ÆÆ‡Ææ (‡Æ®‡Ææ‡Æï‡Ææ‡Æ≤‡Ææ‡Æ®‡Øç‡Æ§‡ØÅ)", lat:25.6751, lon:94.1086, kind:'capital', radiusKm:60 },
  { en:"Bhubaneswar (Odisha)", ta:"‡Æ™‡ØÅ‡Æµ‡Æ©‡Øá‡Æ∏‡Øç‡Æµ‡Æ∞‡Øç (‡Æí‡Æü‡Æø‡Æ∏‡Ææ)", lat:20.2961, lon:85.8245, kind:'capital', radiusKm:60 },
  { en:"Chandigarh (Punjab)", ta:"‡Æö‡Æ£‡Øç‡Æü‡Æø‡Æï‡Æ∞‡Øç (‡Æ™‡Æû‡Øç‡Æö‡Ææ‡Æ™‡Øç)", lat:30.7333, lon:76.7794, kind:'capital', radiusKm:60 },
  { en:"Jaipur (Rajasthan)", ta:"‡Æú‡ØÜ‡ÆØ‡Øç‡Æ™‡Øç‡Æ™‡ØÇ‡Æ∞‡Øç (‡Æ∞‡Ææ‡Æú‡Æ∏‡Øç‡Æ§‡Ææ‡Æ©‡Øç)", lat:26.9124, lon:75.7873, kind:'capital', radiusKm:60 },
  { en:"Gangtok (Sikkim)", ta:"‡Æï‡Ææ‡Æô‡Øç‡Æü‡Ææ‡Æï‡Øç (‡Æö‡Æø‡Æï‡Øç‡Æï‡Æø‡ÆÆ‡Øç)", lat:27.3389, lon:88.6065, kind:'capital', radiusKm:60 },
  { en:"Chennai (Tamil Nadu)", ta:"‡Æö‡ØÜ‡Æ©‡Øç‡Æ©‡Øà (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç‡Æ®‡Ææ‡Æü‡ØÅ)", lat:13.0827, lon:80.2707, kind:'capital', radiusKm:50 },
  { en:"Hyderabad (Telangana)", ta:"‡Æπ‡Øà‡Æ§‡Æ∞‡Ææ‡Æ™‡Ææ‡Æ§‡Øç (‡Æ§‡ØÜ‡Æ≤‡Æô‡Øç‡Æï‡Ææ‡Æ©‡Ææ)", lat:17.3850, lon:78.4867, kind:'capital', radiusKm:60 },
  { en:"Agartala (Tripura)", ta:"‡ÆÖ‡Æï‡Æ∞‡Øç‡Æ§‡Æ≤‡Ææ (‡Æ§‡Æø‡Æ∞‡Æø‡Æ™‡ØÅ‡Æ∞‡Ææ)", lat:23.8315, lon:91.2868, kind:'capital', radiusKm:60 },
  { en:"Lucknow (Uttar Pradesh)", ta:"‡Æ≤‡Æï‡Øç‡Æ©‡Øã (‡Æâ‡Æ§‡Øç‡Æ§‡Æ∞‡Æ™‡Øç ‡Æ™‡Æø‡Æ∞‡Æ§‡Øá‡Æö‡ÆÆ‡Øç)", lat:26.8467, lon:80.9462, kind:'capital', radiusKm:60 },
  { en:"Dehradun (Uttarakhand)", ta:"‡Æ§‡Øá‡Æ∞‡Ææ‡Æ§‡ØÇ‡Æ©‡Øç (‡Æâ‡Æ§‡Øç‡Æ§‡Æ∞‡Æï‡Ææ‡Æ£‡Øç‡Æü‡Øç)", lat:30.3165, lon:78.0322, kind:'capital', radiusKm:60 },
  { en:"Kolkata (West Bengal)", ta:"‡Æï‡Øä‡Æ≤‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Ææ (‡ÆÆ‡Øá‡Æ±‡Øç‡Æï‡ØÅ ‡Æµ‡Æô‡Øç‡Æï‡Ææ‡Æ≥‡ÆÆ‡Øç)", lat:22.5726, lon:88.3639, kind:'capital', radiusKm:60 },

  // ---- Major physical features ----
  { en:"Himalayas", ta:"‡Æá‡ÆÆ‡ÆØ‡ÆÆ‡Æ≤‡Øà", lat:30.0, lon:80.0, kind:'range', radiusKm:220 },
  { en:"Indo-Gangetic Plain", ta:"‡Æï‡Æô‡Øç‡Æï‡Øà ‡Æö‡ÆÆ‡Æµ‡ØÜ‡Æ≥‡Æø", lat:26.5, lon:82.5, kind:'plain', radiusKm:200 },
  { en:"Deccan Plateau", ta:"‡Æü‡ØÜ‡Æï‡Øç‡Æï‡Ææ‡Æ©‡Øç ‡Æ™‡ØÄ‡Æü‡Æ™‡ØÇ‡ÆÆ‡Æø", lat:17.0, lon:78.0, kind:'plateau', radiusKm:200 },
  { en:"Western Ghats", ta:"‡ÆÆ‡Øá‡Æ±‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø ‡ÆÆ‡Æ≤‡Øà", lat:14.0, lon:74.0, kind:'range', radiusKm:160 },
  { en:"Eastern Ghats", ta:"‡Æï‡Æø‡Æ¥‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æö‡Øç‡Æö‡Æø ‡ÆÆ‡Æ≤‡Øà", lat:18.0, lon:83.0, kind:'range', radiusKm:160 },
  { en:"Aravalli Range", ta:"‡ÆÖ‡Æ±‡Ææ‡Æµ‡Æ≤‡Øç‡Æ≤‡Æø ‡ÆÆ‡Æ≤‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç", lat:25.5, lon:73.0, kind:'range', radiusKm:140 },
  { en:"Vindhya Range", ta:"‡Æµ‡Æø‡Æ®‡Øç‡Æ§‡Øç‡ÆØ ‡ÆÆ‡Æ≤‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç", lat:24.0, lon:78.0, kind:'range', radiusKm:140 },
  { en:"Satpura Range", ta:"‡Æö‡Æ§‡Øç‡Æ™‡ØÅ‡Æ∞‡Ææ ‡ÆÆ‡Æ≤‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç", lat:22.5, lon:78.5, kind:'range', radiusKm:140 },
  { en:"Thar Desert", ta:"‡Æ§‡Ææ‡Æ∞‡Øç ‡Æ™‡Ææ‡Æ≤‡Øà‡Æµ‡Æ©‡ÆÆ‡Øç", lat:27.0, lon:71.0, kind:'desert', radiusKm:180 },
  { en:"Rann of Kutch", ta:"‡Æï‡Æö‡Øç‡Æö‡Øç ‡Æâ‡Æ™‡Øç‡Æ™‡ØÅ ‡Æö‡ÆÆ‡Æµ‡ØÜ‡Æ≥‡Æø", lat:23.9, lon:69.2, kind:'region', radiusKm:150 },
  { en:"Sunderbans", ta:"‡Æö‡ØÅ‡Æ®‡Øç‡Æ§‡Æ∞‡Øç‡Æ™‡Æ©‡Øç‡Æï‡Æ≥‡Øç", lat:21.9, lon:89.2, kind:'delta', radiusKm:120 },
  { en:"Konkan Coast", ta:"‡Æï‡Øä‡Æô‡Øç‡Æï‡Æ£‡Øç ‡Æï‡Æü‡Æ±‡Øç‡Æï‡Æ∞‡Øà", lat:16.8, lon:73.5, kind:'coast', radiusKm:160 },
  { en:"Malabar Coast", ta:"‡ÆÆ‡Æ≤‡Æ™‡Ææ‡Æ∞‡Øç ‡Æï‡Æü‡Æ±‡Øç‡Æï‡Æ∞‡Øà", lat:10.5, lon:76.0, kind:'coast', radiusKm:160 },
  { en:"Coromandel Coast", ta:"‡Æï‡Øä‡Æ∞‡Øã‡ÆÆ‡Æ£‡Øç‡Æü‡Æ≤‡Øç ‡Æï‡Æü‡Æ±‡Øç‡Æï‡Æ∞‡Øà", lat:12.0, lon:80.0, kind:'coast', radiusKm:160 },
  { en:"Bay of Bengal", ta:"‡Æµ‡Æô‡Øç‡Æï‡Ææ‡Æ≥ ‡Æµ‡Æø‡Æ∞‡Æø‡Æï‡ØÅ‡Æü‡Ææ", lat:15.0, lon:88.0, kind:'sea', radiusKm:250 },
  { en:"Arabian Sea", ta:"‡ÆÖ‡Æ∞‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æü‡Æ≤‡Øç", lat:15.0, lon:68.0, kind:'sea', radiusKm:250 },

  // ---- Rivers (central points for quiz) ----
  { en:"Ganga (Ganges) River", ta:"‡Æï‡Æô‡Øç‡Æï‡Øà ‡Æ®‡Æ§‡Æø", lat:25.6, lon:83.0, kind:'river', radiusKm:150 },
  { en:"Yamuna River", ta:"‡ÆØ‡ÆÆ‡ØÅ‡Æ©‡Ææ ‡Æ®‡Æ§‡Æø", lat:27.2, lon:77.6, kind:'river', radiusKm:120 },
  { en:"Brahmaputra River", ta:"‡Æ™‡Æø‡Æ∞‡ÆÆ‡Øç‡ÆÆ‡Æ™‡ØÅ‡Æ§‡Øç‡Æ∞‡Ææ ‡Æ®‡Æ§‡Æø", lat:26.0, lon:92.0, kind:'river', radiusKm:180 },
  { en:"Godavari River", ta:"‡Æï‡Øã‡Æ§‡Ææ‡Æµ‡Æ∞‡Æø ‡Æ®‡Æ§‡Æø", lat:18.6, lon:79.5, kind:'river', radiusKm:140 },
  { en:"Krishna River", ta:"‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡Øç‡Æ£‡Ææ ‡Æ®‡Æ§‡Æø", lat:16.6, lon:80.8, kind:'river', radiusKm:140 },
  { en:"Narmada River", ta:"‡Æ®‡Æ∞‡Øç‡ÆÆ‡Æ§‡Ææ ‡Æ®‡Æ§‡Æø", lat:22.6, lon:76.0, kind:'river', radiusKm:140 },
  { en:"Tapti (Tapi) River", ta:"‡Æ§‡Ææ‡Æ™‡Øç‡Æ§‡Æø ‡Æ®‡Æ§‡Æø", lat:21.2, lon:75.7, kind:'river', radiusKm:140 }
];

/* =========================
   State
   ========================= */
const HOF_KEY = 'locate_india_hof_v1'; // per language
let currentRound = [];
let idx = 0;
let score = 0;
let marker = null;
let practiceLayer = null;
let awaitingClick = false;

/* =========================
   DOM
   ========================= */
const startBtn = document.getElementById('startBtn');
const msgEl = document.getElementById('msg');
const scoreBox = document.getElementById('scoreBox');
const scoreEl = document.getElementById('score');
const outOfEl = document.getElementById('outOf');
const qProgEl = document.getElementById('qProg');
const hofList = document.getElementById('hofList');

/* =========================
   Helpers
   ========================= */
function getLang(){ return (document.querySelector('input[name="lang"]:checked')?.value)||'en'; }
function getMode(){ return (document.querySelector('input[name="mode"]:checked')?.value)||'practice'; }
function cityLabel(item, lang){ return item[lang] || item.en; }
function sampleN(arr, n){
  const c = arr.slice();
  for(let i=c.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [c[i],c[j]]=[c[j],c[i]]; }
  return c.slice(0,n);
}
function clearPracticeLayer(){ if(practiceLayer){ map.removeLayer(practiceLayer); practiceLayer=null; } }
function showPracticeLabels(list, lang){
  clearPracticeLayer();
  practiceLayer = L.layerGroup();
  list.forEach(it=>{
    const m = L.circleMarker([it.lat,it.lon], {radius:6,color:'#2563eb',fillColor:'#3b82f6',fillOpacity:0.85});
    m.bindTooltip(cityLabel(it,lang), {permanent:true, direction:'right', offset:[6,0]});
    m.addTo(practiceLayer);
  });
  practiceLayer.addTo(map);
}
function updateScoreUI(show){
  scoreBox.style.display = show ? 'block' : 'none';
  scoreEl.textContent = score;
  outOfEl.textContent = currentRound.length || 10;
  qProgEl.textContent = `Q ${Math.min(idx+1, currentRound.length)}/${currentRound.length}`;
}
function distKm(a, b){ return map.distance(a, b) / 1000; }

/* =========================
   Hall of Fame (Test only)
   ========================= */
function loadHOF(){ try{ return JSON.parse(localStorage.getItem(HOF_KEY)||'[]'); }catch(_){ return []; } }
function saveHOF(entry){ const list=loadHOF(); list.push(entry); localStorage.setItem(HOF_KEY, JSON.stringify(list)); }
function renderHOF(){
  const lang = getLang();
  const list = loadHOF().filter(x=>x.lang===lang).sort((a,b)=> b.score-a.score || a.date-b.date).slice(0,10);
  if(list.length===0){ hofList.innerHTML = '<div class="muted">No entries yet. Finish a Test to appear here.</div>'; return; }
  hofList.innerHTML = '';
  list.forEach((it,i)=>{
    const d = new Date(it.date);
    const dd=String(d.getDate()).padStart(2,'0'), mm=String(d.getMonth()+1).padStart(2,'0'), yyyy=d.getFullYear();
    const row = document.createElement('div');
    row.className='hof-item';
    row.innerHTML = `<div><b>${i+1}.</b> ${it.name||'Anonymous'} ‚Äî <span class="pill">${it.score}/${it.total}</span></div>
                     <div class="muted">${(it.lang||'EN').toUpperCase()} ‚Ä¢ ${dd}/${mm}/${yyyy}</div>`;
    hofList.appendChild(row);
  });
}

/* =========================
   Quiz flow
   ========================= */
function startRound(){
  msgEl.textContent = '';
  currentRound = sampleN(itemsIN, 10);
  idx = 0;
  score = 0;
  clearPracticeLayer();
  if(marker){ map.removeLayer(marker); marker=null; }

  const lang = getLang();
  const mode = getMode();

  if(mode === 'practice'){ updateScoreUI(false); showPracticeLabels(currentRound, lang); }
  else { updateScoreUI(true); }

  // Fly to first area & prompt
  const first = currentRound[0];
  map.setView([first.lat, first.lon], first.kind==='capital'?6:5);
  alert(`${lang==='ta'?'‡Æï‡Æ£‡Øç‡Æü‡ØÅ‡Æ™‡Æø‡Æü‡Æø':'Locate'}: ${cityLabel(first, lang)}`);

  awaitingClick = true;
  map.once('click', onMapClick);
  renderHOF();
}

function onMapClick(e){
  if(!awaitingClick) return;
  const item = currentRound[idx];
  const lang = getLang();
  const mode = getMode();
  const target = [item.lat, item.lon];
  const dkm = distKm(e.latlng, target);
  const threshold = item.radiusKm || 60;

  if(mode === 'test'){
    if(dkm <= threshold){ alert(`‚úÖ ${lang==='ta'?'‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æï ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æ§‡ØÅ':'Correct'}! (${dkm.toFixed(1)} km)`); score++; }
    else { alert(`‚ùå ${lang==='ta'?'‡Æ§‡Æµ‡Æ±‡ØÅ':'Incorrect'}. ${dkm.toFixed(1)} km away.`); }
    scoreEl.textContent = score;
  } else {
    // practice: feedback only
    if(dkm <= threshold){ alert(`üëç ${lang==='ta'?'‡Æ®‡Æ≤‡Øç‡Æ≤ ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø':'Good try'}! (${dkm.toFixed(1)} km)`); }
    else { alert(`‚ÑπÔ∏è ${dkm.toFixed(1)} km away.`); }
  }

  // Reveal true location
  if(marker) map.removeLayer(marker);
  marker = L.marker(target).addTo(map).bindPopup(cityLabel(item,lang)).openPopup();

  // Next
  idx++;
  if(idx < currentRound.length){
    updateScoreUI(getMode()==='test');
    setTimeout(()=>{
      const next = currentRound[idx];
      map.setView([next.lat, next.lon], next.kind==='capital'?6:5);
      alert(`${lang==='ta'?'‡Æï‡Æ£‡Øç‡Æü‡ØÅ‡Æ™‡Æø‡Æü‡Æø':'Locate'}: ${cityLabel(next, lang)}`);
      map.once('click', onMapClick);
    }, 700);
  } else {
    // End
    updateScoreUI(getMode()==='test');
    const total = currentRound.length;
    if(getMode()==='test'){
      setTimeout(()=>{
        const promptText = (lang==='ta'
          ? `üèÅ ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ! ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡ØÜ‡Æ£‡Øç: ${score}/${total}\n\nHall of Fame-‡Æá‡Æ≤‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü ‡Æµ‡Øá‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Ææ?`
          : `üèÅ Test Over! Your score: ${score}/${total}\n\nEnter your name for the Hall of Fame (optional):`);
        const name = prompt(promptText, '') || 'Anonymous';
        saveHOF({ name, lang:getLang(), score, total, date:Date.now() });
        renderHOF();
      }, 150);
    } else {
      alert(lang==='ta'?'‚úÖ ‡Æ™‡ÆØ‡Æø‡Æ±‡Øç‡Æö‡Æø ‡ÆÆ‡ØÅ‡Æü‡Æø‡Æ®‡Øç‡Æ§‡Æ§‡ØÅ!':'‚úÖ Practice round complete!');
    }
  }
}

/* =========================
   Events
   ========================= */
startBtn.addEventListener('click', startRound);
document.querySelectorAll('input[name="lang"]').forEach(el=> el.addEventListener('change', renderHOF));
document.querySelectorAll('input[name="mode"]').forEach(el=> el.addEventListener('change', ()=>{
  // Only toggles visibility of score chip mid-round; labels unchanged until restart
  updateScoreUI(getMode()==='test');
}));

// initial leaderboard render
renderHOF();
</script>
</body>
</html>
